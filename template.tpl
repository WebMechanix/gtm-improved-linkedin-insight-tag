___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Improved LinkedIn Insight Tag",
  "categories": [
    "ADVERTISING", 
    "ANALYTICS",
    "CONVERSIONS", 
    "LEAD_GENERATION", 
    "MARKETING", 
    "SOCIAL"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAIAAAC1nk4lAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA25pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDYuMC1jMDAyIDExNi4xNjQ2NTUsIDIwMjEvMDEvMjYtMTU6NDE6MjAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ODlkMDQ0YTctMDVlYS00MDZkLWE1MTAtYmU2YjQ1N2I5MjYzIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjcwRTE1MTg0NzFFQjExRUI5MDVEOUY3Q0Y5QzA5Qjg5IiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjcwRTE1MTgzNzFFQjExRUI5MDVEOUY3Q0Y5QzA5Qjg5IiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMS4wIChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Nzk4NDM4RjlGQ0RBMTFFQUFENDU4Qzg1RjlCQ0NCMDkiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Nzk4NDM4RkFGQ0RBMTFFQUFENDU4Qzg1RjlCQ0NCMDkiLz4gPC9yZGY6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\u003d"
  },
  "description": "An optimized (and greatly simplified) LinkedIn Insight tag template that actually works like it should. Includes support for overriding advanced conversion options not well documented by LinkedIn.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "partnerId",
    "displayName": "Partner ID / Insight Tag ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^\\d+(,\\s?\\d+)*$"
        ]
      }
    ],
    "notSetText": "Enter one or more comma separated IDs."
  },
  {
    "type": "TEXT",
    "name": "conversionId",
    "displayName": "Conversion IDs (max. 3)",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^\\d+(,\\s?\\d+)*$"
        ]
      }
    ],
    "help": "Enter 1-3 conversion ids separated by comma. Only first 3 conversion ids will be sent. This field is optional."
  },
  {
    "type": "GROUP",
    "name": "advanced",
    "displayName": "Advanced Conversion Options",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "TEXT",
        "name": "conversionUrl",
        "displayName": "Custom URL Override",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "REGEX",
            "args": [
              "^https?:\\/\\/.*"
            ]
          }
        ],
        "help": "(Override) This is different than Match rules. Enter a URL only if you were specifically provided one by LinkedIn to override."
      },
      {
        "type": "TEXT",
        "name": "conversionValue",
        "displayName": "Conversion Value",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NUMBER"
          }
        ],
        "help": "Monetary value associated with the conversion.\u003cbr\u003e\u003cbr\u003e \u003cstrong\u003eA \"Conversion Currency\" is required if a value is provided.\u003cstrong\u003e"
      },
      {
        "type": "TEXT",
        "name": "conversionCurrency",
        "displayName": "Conversion Currency",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "REGEX",
            "args": [
              "[A-Z]{3}"
            ]
          }
        ],
        "help": "Currency of the value associated with the conversion, in \u003ca href\u003d\"https://en.wikipedia.org/wiki/ISO_4217#Active_codes\" target\u003d\"_blank\"\u003e3-letter ISO 4217\u003c/a\u003e format.\n\u003cbr\u003e\u003cbr\u003e\n\u003cstrong\u003eCurrency is required if a \"Conversion Value\" is provided.\u003cstrong\u003e"
      },
      {
        "type": "SELECT",
        "name": "conversionType",
        "displayName": "Conversion Type",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": "ADD_BILLING_INFO",
            "displayValue": "ADD_BILLING_INFO"
          },
          {
            "value": "ADD_TO_CART",
            "displayValue": "ADD_TO_CART"
          },
          {
            "value": "ADD_TO_LIST",
            "displayValue": "ADD_TO_LIST"
          },
          {
            "value": "BOOK_APPOINTMENT",
            "displayValue": "BOOK_APPOINTMENT"
          },
          {
            "value": "COMPLETE_SIGNUP",
            "displayValue": "COMPLETE_SIGNUP"
          },
          {
            "value": "CONTACT",
            "displayValue": "CONTACT"
          },
          {
            "value": "DONATE",
            "displayValue": "DONATE"
          },
          {
            "value": "DOWNLOAD",
            "displayValue": "DOWNLOAD"
          },
          {
            "value": "KEY_PAGE_VIEW",
            "displayValue": "KEY_PAGE_VIEW"
          },
          {
            "value": "LEAD",
            "displayValue": "LEAD"
          },
          {
            "value": "LOGIN",
            "displayValue": "LOGIN"
          },
          {
            "value": "OUTBOUND_CLICK",
            "displayValue": "OUTBOUND_CLICK"
          },
          {
            "value": "PHONE_CALL",
            "displayValue": "PHONE_CALL"
          },
          {
            "value": "PURCHASE",
            "displayValue": "PURCHASE"
          },
          {
            "value": "REQUEST_QUOTE",
            "displayValue": "REQUEST_QUOTE"
          },
          {
            "value": "SAVE",
            "displayValue": "SAVE"
          },
          {
            "value": "SCHEDULE",
            "displayValue": "SCHEDULE"
          },
          {
            "value": "SEARCH",
            "displayValue": "SEARCH"
          },
          {
            "value": "SHARE",
            "displayValue": "SHARE"
          },
          {
            "value": "SIGN_UP",
            "displayValue": "SIGN_UP"
          },
          {
            "value": "START_CHECKOUT",
            "displayValue": "START_CHECKOUT"
          },
          {
            "value": "START_TRIAL",
            "displayValue": "START_TRIAL"
          },
          {
            "value": "SUBMIT_APPLICATION",
            "displayValue": "SUBMIT_APPLICATION"
          },
          {
            "value": "SUBSCRIBE",
            "displayValue": "SUBSCRIBE"
          },
          {
            "value": "VIEW_CONTENT",
            "displayValue": "VIEW_CONTENT"
          },
          {
            "value": "VIEW_VIDEO",
            "displayValue": "VIEW_VIDEO"
          }
        ],
        "simpleValueType": true,
        "notSetText": "(Not Set)"
      },
      {
        "type": "TEXT",
        "name": "orderId",
        "displayName": "Order ID",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "eventId",
        "displayName": "Event ID",
        "simpleValueType": true
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const copyFromWindow = require('copyFromWindow');
const createArgumentsQueue = require('createArgumentsQueue');
const createQueue = require('createQueue');
const getUrl = require('getUrl');
const injectScript = require('injectScript');
const log = require('logToConsole');

/**
 * Check that we have the bare minimum data to run the tag
 * Otherwise, fail & return early.
 */
if (!data.partnerId) {
  data.gtmOnFailure(); 
  return;
}

/**
 * Set globals
 *
 * a. _linkedin_data_partner_ids - an array that stores all partner IDs the data should be sent to.
 * b. lintrk, linrtk.q - a temporary queue used to store commands sent to the insight tag that will be processed whenever the script is loaded.
 */

const setPartnerId = createQueue('_linkedin_data_partner_ids');
const lintrk = createArgumentsQueue('lintrk', 'lintrk.q');

if (data.conversionUrl) {
  lintrk('track', {
    conversion_url: data.conversion_url
  });
}

/**
 * Push & Deduplicate Partner IDs _linkedin_data_partner_ids global
 */
const partnerIds = data.partnerId.split(',');
partnerIds.forEach(id => {
  
  id = id.trim();
  
  let ids = copyFromWindow('_linkedin_data_partner_ids');
  
  // If the partner ID already exists in the global array - there's no reason to push it again.
  if (ids.indexOf(id) === -1)
    setPartnerId(id);
  
});

/**
 * If execute track commands on the lintrk global for each Conversion ID provided
 */

const makeConversionOptionsObject = (data) => {
  
  let options = {
    tmsource: 'WebMechanix: gtm-improved-linkedin-insight-tag'
  };
  
  const dataMap = {
    conversionType: 'conversion_type',
    conversionCurrency: 'conversion_currency',
    conversionValue: 'conversion_value',
    orderId: 'order_id',
    eventId: 'event_id',
    conversionUrl: 'conversion_url'
  };
  
  for (let prop in dataMap) {
    if (!dataMap.hasOwnProperty(prop)) continue;
    options[dataMap[prop]] = data[prop];
  }
  
  return options;
  
};

const conversionIds = data.conversionId ? data.conversionId.split(',').slice(0,3) : [];
let conversionOptions = makeConversionOptionsObject(data);
conversionIds.forEach(id => {
 
  conversionOptions.conversion_id = id.trim();
  
  lintrk('track', conversionOptions);
  
});

/**
 * Inject the insight.min.js script.
 */
const scriptSrc = 'https://snap.licdn.com/li.lms-analytics/insight.min.js';
injectScript(scriptSrc, data.gtmOnSuccess, data.gtmOnFailure, scriptSrc);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://snap.licdn.com/li.lms-analytics/insight.min.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "lintrk"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "lintrk.q"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "lintrk.q.push"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_linkedin_data_partner_ids"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_linkedin_data_partner_ids.push"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Should fail when partner id is empty or not provided
  code: |-
    const mockData = {
      partnerId: undefined
    };

    runCode(mockData);

    assertApi('gtmOnFailure').wasCalled();
- name: partner id global contains all partner ids
  code: |-
    const copyFromWindow = require('copyFromWindow');
    const log = require('logToConsole');

    const mockData = {
      partnerId: '0001, 0002'
    };

    runCode(mockData);

    const _linkedin_data_partner_ids = copyFromWindow('_linkedin_data_partner_ids');
    log('_linkedin_data_partner_ids', _linkedin_data_partner_ids);

    assertThat(_linkedin_data_partner_ids.length).isEqualTo(2);
- name: partner ids are deduplicated
  code: |-
    const copyFromWindow = require('copyFromWindow');
    const log = require('logToConsole');

    const mockData = {
      partnerId: '0000, 0001, 0002, 0001'
    };

    runCode(mockData);

    const _linkedin_data_partner_ids = copyFromWindow('_linkedin_data_partner_ids');
    log('_linkedin_data_partner_ids', _linkedin_data_partner_ids);

    assertThat(_linkedin_data_partner_ids.length).isEqualTo(3);
- name: Should inject insight js file
  code: |-
    const mockData = {
      partnerId: '0000'
    };

    mock('injectScript', (url) => {
      assertThat(url, 'correct script download URL is called').isEqualTo('https://snap.licdn.com/li.lms-analytics/insight.min.js');
    });

    runCode(mockData);
setup: ''


___NOTES___

Created on 10/11/2023, 12:50:44 PM


